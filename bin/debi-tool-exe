#!/bin/bash

# Yad based front-end to gdebi-core, apt & dpkg as an alternative for gdebi-gtk/kde tools
# Copyright Pawe≈Ç "pavroo" Pijanowski 2018 under GNU GPL
# Last update 2018/07/05

# get default's locale file
DEFLOCDIR="/usr/share/sparky/debi-tool"
if [ "`cat /etc/default/locale | grep pl_PL`" != "" ]; then
. $DEFLOCDIR/pl
else
. $DEFLOCDIR/en
fi

testroot="`whoami`"
if [ "$testroot" != "root" ]; then
	/usr/bin/remsu $0 &
fi

DIALOG700="yad --window-icon=application-x-deb --width=700 --height=600 --center"
DIALOG="yad --window-icon=application-x-deb --width=450 --height=200 --center"
TITLE="--always-print-result --dialog-sep --image=application-x-deb --title="
TEXT="--text="
#FILESELECTION="--file-selection "
#FILTER="--file-filter"
MSGBOX="--button=Ok:0"
TITLETEXT="DEBiTool"
TEMPFILE="/tmp/debitool/debitoolconf"
TEMPDIR="/tmp/debitool"
BUTTONREMOVE="--button=$LOCAL8:3"
BUTTONREINSTALL="--button=$LOCAL9:4"
BUTTONINSTALL="--button=$LOCAL10:0"
BUTTONEXIT="--button=$LOCAL12:1"
INSTALL="apt-get install"
REINSTALL="apt-get install --reinstall"
UNINSTALL="apt-get purge"
CLEAN="apt-get autoremove"
UPDATE="apt-get update"
GDEBI="gdebi"
FIX="apt-get install-f"
ARCH64="`uname -m | grep x86_64`"
ARCH32="`uname -m | grep 686`"
ARCHARM="`uname -m | grep arm`"
#PINGTEST=$(ping -c 1 debian.org | grep [0-9])
if [ -f /usr/bin/sparky-xterm ];then
	SPARKYXTERM="/usr/bin/sparky-xterm"
else
	echo "sparky-xterm is missing... Exiting..."
	exit 1
fi

DEBFILE=`cat $TEMPDIR/debname`
cd $TEMPDIR
DEBPACK=`ls | grep *.deb`

if [ "$1" = "remove" ]; then
	# remove deb
	$SPARKYXTERM "$UNINSTALL $DEBFILE"
	$SPARKYXTERM "$CLEAN"

elif [ "$1" = "reinstall" ]; then
	# reinstall deb
	$SPARKYXTERM "$REINSTALL $DEBFILE"

elif [ "$1" = "inst" ]; then
	# install deb
	#if [ "$PINGTEST" = "" ]; then
	#	$DIALOG $TITLE"$TITLETEXT" $MSGBOX $TEXT"$LOCAL13 \n\n$LOCAL3"
	#	exit 1
	#fi
	#$SPARKYXTERM "$INSTALL $DEBFILE"
	#$SPARKYXTERM "$UPDATE"
	#$SPARKYXTERM "$FIX"
	$SPARKYXTERM "$GDEBI $DEBPACK"
fi

rm -rf $TEMPDIR

exit 0
